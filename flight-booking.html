<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlightsMND - Reserva de Voo</title>
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
            background: #f8f9fa;
        }

        /* Header Styles */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header.scrolled {
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 30px;
            align-items: center;
        }

        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-menu a:hover {
            color: #667eea;
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn-register, .btn-login {
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-register {
            color: #667eea;
            border: 2px solid #667eea;
            background: transparent;
        }

        .btn-login {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        /* Breadcrumb */
        .breadcrumb-section {
            margin-top: 70px;
            padding: 40px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .breadcrumb-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><circle cx="200" cy="200" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="800" cy="300" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="400" cy="600" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="700" cy="800" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
            animation: twinkle 4s linear infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .breadcrumb-content {
            position: relative;
            z-index: 2;
        }

        .breadcrumb-content h2 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .breadcrumb-nav {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }

        .breadcrumb-nav a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        /* Main Content */
        .main-content {
            padding: 40px 0;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
        }

        /* Progress Indicator */
        .progress-indicator {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
        }

        .progress-step::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #e9ecef;
            z-index: 1;
        }

        .progress-step:last-child::after {
            display: none;
        }

        .progress-step.active::after {
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .step-circle {
            width: 30px;
            height: 30px;
            background: #e9ecef;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: #666;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .progress-step.completed .step-circle {
            background: #4CAF50;
            color: white;
        }

        .step-label {
            font-size: 12px;
            font-weight: 500;
            color: #666;
            margin-top: 8px;
            text-align: center;
        }

        .progress-step.active .step-label {
            color: #667eea;
            font-weight: 600;
        }

        /* Flight Summary Card */
        .flight-summary-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .flight-summary-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flight-summary-content {
            padding: 25px;
        }

        .flight-route {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
        }

        .flight-point {
            text-align: center;
        }

        .flight-time {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .flight-airport {
            font-size: 1.1rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 3px;
        }

        .flight-date {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .flight-path {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .flight-duration {
            font-size: 14px;
            font-weight: 600;
            color: #666;
            margin-bottom: 10px;
        }

        .flight-line {
            width: 60px;
            height: 2px;
            background: #e9ecef;
            position: relative;
            margin: 5px 0;
        }

        .flight-line::after {
            content: '✈';
            position: absolute;
            top: -8px;
            right: -5px;
            color: #667eea;
            font-size: 12px;
        }

        .flight-stops {
            font-size: 12px;
            color: #666;
        }

        /* Form Cards */
        .form-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .form-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.12);
        }

        .form-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            position: relative;
            overflow: hidden;
        }

        .form-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .form-header h3 {
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 2;
        }

        .form-content {
            padding: 30px;
        }

        /* Form Groups */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .required::after {
            content: '*';
            color: #e74c3c;
            margin-left: 4px;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper i {
            position: absolute;
            left: 15px;
            color: #667eea;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
            font-family: 'Poppins', sans-serif;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .form-input:focus + i, .form-select:focus + i {
            color: #764ba2;
            transform: scale(1.1);
        }

        .form-input.error, .form-select.error {
            border-color: #e74c3c;
        }

        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .form-input.error + .error-message,
        .form-select.error + .error-message {
            display: block;
        }

        /* Passenger Cards */
        .passenger-card {
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .passenger-card:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.02);
        }

        .passenger-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .passenger-number {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1rem;
        }

        .passenger-type {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Checkbox Styles */
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
        }

        .checkbox-group:hover {
            border-color: rgba(102, 126, 234, 0.2);
            background: rgba(102, 126, 234, 0.08);
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
            margin-top: 2px;
        }

        .checkbox-group label {
            margin: 0;
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        .checkbox-group a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .checkbox-group a:hover {
            color: #764ba2;
        }

        /* Submit Button */
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:active {
            transform: translateY(-1px);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 90px;
            height: fit-content;
        }

        .sidebar-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.12);
        }

        /* Flight Info Card */
        .flight-info-card {
            position: relative;
            overflow: hidden;
        }

        .flight-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .flight-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .flight-image:hover img {
            transform: scale(1.05);
        }

        .flight-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.6) 100%);
        }

        .airline-logo {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 60px;
            height: 40px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #667eea;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .flight-details {
            padding: 20px;
        }

        .airline-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .flight-route-text {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        /* Booking Details */
        .detail-section {
            border-bottom: 1px solid #f0f0f0;
            padding: 20px;
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-section h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: #666;
            font-size: 14px;
        }

        .detail-value {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        /* Payment Summary */
        .payment-table {
            width: 100%;
            border-collapse: collapse;
        }

        .payment-table td {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .payment-table td:first-child {
            font-weight: 500;
            color: #666;
        }

        .payment-table td:last-child {
            font-weight: 600;
            color: #333;
            text-align: right;
        }

        .payment-table .total-row {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .payment-table .total-row td {
            border-bottom: none;
            font-weight: 700;
            font-size: 16px;
            padding: 15px;
        }

        /* Security Badge */
        .security-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.2);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .security-badge i {
            color: #4CAF50;
            font-size: 20px;
        }

        .security-text {
            color: #2E7D32;
            font-weight: 500;
            font-size: 14px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .loading-description {
            font-size: 14px;
            color: #666;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            max-width: 400px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .notification.error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .notification.info {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .notification.warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            margin-left: auto;
        }

        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            .content-wrapper {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .sidebar {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 15px;
                padding: 10px 20px;
            }

            .breadcrumb-section {
                margin-top: 90px;
                padding: 30px 0;
            }

            .breadcrumb-content h2 {
                font-size: 2rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .form-header {
                padding: 20px;
            }

            .form-content {
                padding: 20px;
            }

            .progress-indicator {
                flex-direction: column;
                gap: 15px;
            }

            .progress-step::after {
                display: none;
            }

            .flight-route {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .flight-path {
                transform: rotate(90deg);
            }
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-up {
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <nav class="nav-container">
            <div class="logo">FlightsMND</div>
            <ul class="nav-menu">
                <li><a href="index.html">Início</a></li>
                <li><a href="index.html#about">Sobre</a></li>
                <li><a href="index.html#destinations">Destinos</a></li>
                <li><a href="index.html#contact">Contato</a></li>
            </ul>
            <div class="auth-buttons">
                <a href="login.html" class="btn-register">Registrar</a>
                <a href="login.html" class="btn-login">Login</a>
            </div>
        </nav>
    </header>

    <!-- Breadcrumb -->
    <section class="breadcrumb-section">
        <div class="breadcrumb-content">
            <h2 id="breadcrumb-title">Reserva de Voo</h2>
            <nav class="breadcrumb-nav">
                <a href="index.html">Início</a> / 
                <a href="flight-results.html">Resultados</a> / 
                <span>Reserva</span>
            </nav>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Progress Indicator -->
            <div class="progress-indicator fade-in">
                <div class="progress-step completed">
                    <div class="step-circle">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="step-label">Buscar Voos</div>
                </div>
                <div class="progress-step completed">
                    <div class="step-circle">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="step-label">Selecionar Voo</div>
                </div>
                <div class="progress-step active">
                    <div class="step-circle">3</div>
                    <div class="step-label">Informações</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle">4</div>
                    <div class="step-label">Pagamento</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle">5</div>
                    <div class="step-label">Confirmação</div>
                </div>
            </div>

            <!-- Flight Summary -->
            <div class="flight-summary-card slide-up">
                <div class="flight-summary-header">
                    <h3>
                        <i class="fas fa-plane"></i>
                        Resumo do Voo
                    </h3>
                    <div id="flight-number">Carregando...</div>
                </div>
                <div class="flight-summary-content">
                    <div class="flight-route">
                        <div class="flight-point">
                            <div class="flight-time" id="departure-time">--:--</div>
                            <div class="flight-airport" id="departure-airport">---</div>
                            <div class="flight-date" id="departure-date">-- --- ----</div>
                        </div>
                        <div class="flight-path">
                            <div class="flight-duration" id="flight-duration">--h --m</div>
                            <div class="flight-line"></div>
                            <div class="flight-stops" id="flight-stops">Carregando...</div>
                        </div>
                        <div class="flight-point">
                            <div class="flight-time" id="arrival-time">--:--</div>
                            <div class="flight-airport" id="arrival-airport">---</div>
                            <div class="flight-date" id="arrival-date">-- --- ----</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-wrapper">
                <!-- Main Content Area -->
                <div class="main-area">
                    <!-- Passengers Forms -->
                    <div class="form-card slide-up">
                        <div class="form-header">
                            <h3>
                                <i class="fas fa-users"></i>
                                Informações dos Passageiros
                            </h3>
                        </div>
                        <div class="form-content">
                            <div id="passengers-container">
                                <!-- Passenger forms will be generated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="form-card slide-up">
                        <div class="form-header">
                            <h3>
                                <i class="fas fa-envelope"></i>
                                Informações de Contato
                            </h3>
                        </div>
                        <div class="form-content">
                            <form id="contactForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="required">Email Principal</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-envelope"></i>
                                            <input type="email" class="form-input" name="email" placeholder="seu@email.com" required>
                                        </div>
                                        <div class="error-message">Email é obrigatório</div>
                                    </div>
                                    <div class="form-group">
                                        <label class="required">Telefone</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-phone"></i>
                                            <input type="tel" class="form-input" name="phone" placeholder="(11) 99999-9999" required>
                                        </div>
                                        <div class="error-message">Telefone é obrigatório</div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Observações Especiais</label>
                                    <div class="input-wrapper">
                                        <i class="fas fa-comment"></i>
                                        <textarea class="form-textarea" name="remarks" placeholder="Alguma solicitação especial? (Refeições, assento, etc.)"></textarea>
                                    </div>
                                </div>

                                <div class="checkbox-group">
                                    <input type="checkbox" id="terms" required>
                                    <label for="terms">
                                        Concordo com os <a href="#" onclick="showTerms()">termos e condições</a> de uso da FlightsMND.
                                    </label>
                                </div>

                                <div class="checkbox-group">
                                    <input type="checkbox" id="newsletter">
                                    <label for="newsletter">
                                        Desejo receber ofertas e promoções por email.
                                    </label>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Payment Information -->
                    <div class="form-card slide-up">
                        <div class="form-header">
                            <h3>
                                <i class="fas fa-credit-card"></i>
                                Informações de Pagamento
                            </h3>
                        </div>
                        <div class="form-content">
                            <!-- Security Badge -->
                            <div class="security-badge">
                                <i class="fas fa-shield-alt"></i>
                                <div class="security-text">
                                    Transação segura com criptografia SSL de 256 bits
                                </div>
                            </div>

                            <form id="paymentForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="required">Número do Cartão</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-credit-card"></i>
                                            <input type="text" class="form-input" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
                                        </div>
                                        <div class="error-message">Número do cartão é obrigatório</div>
                                    </div>
                                    <div class="form-group">
                                        <label class="required">Nome no Cartão</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-user"></i>
                                            <input type="text" class="form-input" name="cardName" placeholder="Nome conforme no cartão" required>
                                        </div>
                                        <div class="error-message">Nome no cartão é obrigatório</div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="required">Validade</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-calendar"></i>
                                            <input type="text" class="form-input" name="cardExpiry" placeholder="MM/AA" maxlength="5" required>
                                        </div>
                                        <div class="error-message">Data de validade é obrigatória</div>
                                    </div>
                                    <div class="form-group">
                                        <label class="required">CVV</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-lock"></i>
                                            <input type="text" class="form-input" name="cardCVV" placeholder="123" maxlength="4" required>
                                        </div>
                                        <div class="error-message">CVV é obrigatório</div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="required">Bandeira</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-credit-card"></i>
                                            <select class="form-select" name="cardBrand" required>
                                                <option value="">Selecione a bandeira</option>
                                                <option value="visa">Visa</option>
                                                <option value="mastercard">Mastercard</option>
                                                <option value="american-express">American Express</option>
                                                <option value="elo">Elo</option>
                                                <option value="diners">Diners Club</option>
                                            </select>
                                        </div>
                                        <div class="error-message">Bandeira é obrigatória</div>
                                    </div>
                                    <div class="form-group">
                                        <label>Código de Reserva</label>
                                        <div class="input-wrapper">
                                            <i class="fas fa-ticket-alt"></i>
                                            <input type="text" class="form-input" name="bookingCode" id="booking-code" readonly>
                                        </div>
                                    </div>
                                </div>

                                <div class="checkbox-group">
                                    <input type="checkbox" id="payment-terms" required>
                                    <label for="payment-terms">
                                        Autorizo o processamento do pagamento e concordo com as <a href="#" onclick="showPaymentTerms()">condições de pagamento</a>.
                                    </label>
                                </div>

                                <button type="submit" class="submit-btn" id="submit-booking">
                                    <i class="fas fa-lock"></i> Finalizar Reserva
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <aside class="sidebar">
                    <!-- Flight Info -->
                    <div class="sidebar-card flight-info-card">
                        <div class="flight-image">
                            <img id="airline-image" src="https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=400&h=200&fit=crop" alt="Airline">
                            <div class="airline-logo" id="airline-logo">
                                --
                            </div>
                        </div>
                        <div class="flight-details">
                            <h4 class="airline-name" id="airline-name">Carregando...</h4>
                            <p class="flight-route-text" id="flight-route-text">Carregando rota...</p>
                        </div>
                    </div>

                    <!-- Booking Details -->
                    <div class="sidebar-card">
                        <div class="detail-section">
                            <h3>
                                <i class="fas fa-info-circle"></i>
                                Detalhes da Reserva
                            </h3>
                            <div class="detail-item">
                                <div class="detail-label">Data de Partida</div>
                                <div class="detail-value" id="booking-departure-date">--/--/----</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Horário de Partida</div>
                                <div class="detail-value" id="booking-departure-time">--:--</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Classe do Voo</div>
                                <div class="detail-value" id="booking-class">Econômica</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Origem</div>
                                <div class="detail-value" id="booking-origin">---</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Destino</div>
                                <div class="detail-value" id="booking-destination">---</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Duração</div>
                                <div class="detail-value" id="booking-duration">--h --m</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Passageiros</div>
                                <div class="detail-value" id="booking-passengers">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Summary -->
                    <div class="sidebar-card">
                        <div class="detail-section">
                            <h3>
                                <i class="fas fa-calculator"></i>
                                Resumo do Pagamento
                            </h3>
                            <table class="payment-table">
                                <tbody>
                                    <tr>
                                        <td>Tarifa Base</td>
                                        <td id="base-fare">R$ 0,00</td>
                                    </tr>
                                    <tr>
                                        <td>Taxas e Impostos</td>
                                        <td id="taxes-fees">R$ 0,00</td>
                                    </tr>
                                    <tr>
                                        <td>Taxa de Serviço</td>
                                        <td id="service-fee">R$ 45,00</td>
                                    </tr>
                                    <tr>
                                        <td>Subtotal</td>
                                        <td id="subtotal">R$ 0,00</td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr class="total-row">
                                        <td><strong>Total Final</strong></td>
                                        <td id="total-amount"><strong>R$ 0,00</strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loading-text">Processando...</div>
            <div class="loading-description" id="loading-description">Por favor, aguarde...</div>
        </div>
    </div>

    <script>
        // ====================================
        // CONFIGURAÇÃO INICIAL
        // ====================================

        const API_BASE = 'https://flights-api-sigma.vercel.app/api';
        let selectedFlightData = null;
        let searchParams = null;
        let confirmedPricing = null;
        let bookingCode = null;

        // Inicializar página
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        // ====================================
        // INICIALIZAÇÃO DA PÁGINA
        // ====================================

        function initializePage() {
            loadFlightData();
            generateBookingCode();
            setupEventListeners();
            setupFormValidation();
        }

        // ====================================
        // CARREGAMENTO DE DADOS
        // ====================================

        function loadFlightData() {
            // Carregar dados do voo selecionado
            const flightData = sessionStorage.getItem('selectedFlight');
            const searchData = sessionStorage.getItem('searchParams');
            
            if (!flightData) {
                showNotification('Nenhum voo selecionado. Redirecionando...', 'error');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
                return;
            }

            try {
                selectedFlightData = JSON.parse(flightData);
                searchParams = searchData ? JSON.parse(searchData) : null;
                
                console.log('Dados do voo carregados:', selectedFlightData);
                console.log('Parâmetros de busca:', searchParams);
                
                updateFlightDisplay();
                generatePassengerForms();
                updatePricingSummary();
                
            } catch (error) {
                console.error('Erro ao carregar dados do voo:', error);
                showNotification('Erro ao carregar dados do voo', 'error');
            }
        }

        // ====================================
        // ATUALIZAÇÃO DA INTERFACE
        // ====================================

        function updateFlightDisplay() {
            const flight = selectedFlightData;
            const outbound = flight.outbound;
            
            // Datas e horários
            const departureDate = new Date(outbound.departure.at);
            const arrivalDate = new Date(outbound.arrival.at);
            
            // Atualizar título da página
            document.getElementById('breadcrumb-title').textContent = 
                `Reserva ${outbound.carrierCode} ${outbound.number}`;
            
            // Atualizar número do voo
            document.getElementById('flight-number').textContent = 
                `${outbound.carrierCode} ${outbound.number}`;
            
            // Atualizar informações de partida
            document.getElementById('departure-time').textContent = 
                departureDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('departure-airport').textContent = outbound.departure.iataCode;
            document.getElementById('departure-date').textContent = 
                departureDate.toLocaleDateString('pt-BR', { 
                    day: '2-digit', 
                    month: 'short', 
                    year: 'numeric' 
                });
            
            // Atualizar informações de chegada
            document.getElementById('arrival-time').textContent = 
                arrivalDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('arrival-airport').textContent = outbound.arrival.iataCode;
            document.getElementById('arrival-date').textContent = 
                arrivalDate.toLocaleDateString('pt-BR', { 
                    day: '2-digit', 
                    month: 'short', 
                    year: 'numeric' 
                });
            
            // Atualizar duração e escalas
            document.getElementById('flight-duration').textContent = formatDuration(outbound.duration);
            document.getElementById('flight-stops').textContent = 
                outbound.stops === 0 ? 'Voo Direto' : `${outbound.stops} Escala${outbound.stops > 1 ? 's' : ''}`;
            
            // Atualizar informações da sidebar
            document.getElementById('airline-logo').textContent = outbound.carrierCode;
            document.getElementById('airline-name').textContent = getAirlineName(outbound.carrierCode);
            document.getElementById('flight-route-text').textContent = 
                `${outbound.departure.iataCode} → ${outbound.arrival.iataCode}`;
            
            // Atualizar detalhes da reserva
            document.getElementById('booking-departure-date').textContent = 
                departureDate.toLocaleDateString('pt-BR');
            document.getElementById('booking-departure-time').textContent = 
                departureDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('booking-origin').textContent = 
                `${outbound.departure.iataCode}`;
            document.getElementById('booking-destination').textContent = 
                `${outbound.arrival.iataCode}`;
            document.getElementById('booking-duration').textContent = formatDuration(outbound.duration);
            
            // Atualizar número de passageiros
            const totalPassengers = (searchParams?.adults || 1) + 
                                   (searchParams?.children || 0) + 
                                   (searchParams?.infants || 0);
            document.getElementById('booking-passengers').textContent = totalPassengers;
        }

        function generatePassengerForms() {
            const container = document.getElementById('passengers-container');
            const adults = searchParams?.adults || 1;
            const children = searchParams?.children || 0;
            const infants = searchParams?.infants || 0;
            
            container.innerHTML = '';
            
            // Gerar formulários para adultos
            for (let i = 0; i < adults; i++) {
                container.appendChild(createPassengerForm(i + 1, 'Adulto'));
            }
            
            // Gerar formulários para crianças
            for (let i = 0; i < children; i++) {
                container.appendChild(createPassengerForm(adults + i + 1, 'Criança'));
            }
            
            // Gerar formulários para bebês
            for (let i = 0; i < infants; i++) {
                container.appendChild(createPassengerForm(adults + children + i + 1, 'Bebê'));
            }
        }

        function createPassengerForm(passengerNumber, passengerType) {
            const passengerCard = document.createElement('div');
            passengerCard.className = 'passenger-card';
            passengerCard.innerHTML = `
                <div class="passenger-header">
                    <div class="passenger-number">Passageiro ${passengerNumber}</div>
                    <div class="passenger-type">${passengerType}</div>
                </div>
                <form class="passenger-form" data-passenger="${passengerNumber}" data-type="${passengerType}">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Nome</label>
                            <div class="input-wrapper">
                                <i class="fas fa-user"></i>
                                <input type="text" class="form-input" name="firstName" placeholder="Nome" required>
                            </div>
                            <div class="error-message">Nome é obrigatório</div>
                        </div>
                        <div class="form-group">
                            <label class="required">Sobrenome</label>
                            <div class="input-wrapper">
                                <i class="fas fa-user"></i>
                                <input type="text" class="form-input" name="lastName" placeholder="Sobrenome" required>
                            </div>
                            <div class="error-message">Sobrenome é obrigatório</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Data de Nascimento</label>
                            <div class="input-wrapper">
                                <i class="fas fa-calendar"></i>
                                <input type="date" class="form-input" name="dateOfBirth" required>
                            </div>
                            <div class="error-message">Data de nascimento é obrigatória</div>
                        </div>
                        <div class="form-group">
                            <label class="required">Gênero</label>
                            <div class="input-wrapper">
                                <i class="fas fa-venus-mars"></i>
                                <select class="form-select" name="gender" required>
                                    <option value="">Selecione</option>
                                    <option value="M">Masculino</option>
                                    <option value="F">Feminino</option>
                                </select>
                            </div>
                            <div class="error-message">Gênero é obrigatório</div>
                        </div>
                    </div>
                    ${passengerType !== 'Bebê' ? `
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Número do Passaporte</label>
                            <div class="input-wrapper">
                                <i class="fas fa-passport"></i>
                                <input type="text" class="form-input" name="passportNumber" placeholder="Número do passaporte" required>
                            </div>
                            <div class="error-message">Número do passaporte é obrigatório</div>
                        </div>
                        <div class="form-group">
                            <label class="required">Validade do Passaporte</label>
                            <div class="input-wrapper">
                                <i class="fas fa-calendar"></i>
                                <input type="date" class="form-input" name="passportExpiry" required>
                            </div>
                            <div class="error-message">Validade do passaporte é obrigatória</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required">Nacionalidade</label>
                            <div class="input-wrapper">
                                <i class="fas fa-flag"></i>
                                <select class="form-select" name="nationality" required>
                                    <option value="">Selecione</option>
                                    <option value="BR">Brasileira</option>
                                    <option value="US">Americana</option>
                                    <option value="AR">Argentina</option>
                                    <option value="PT">Portuguesa</option>
                                    <option value="FR">Francesa</option>
                                    <option value="DE">Alemã</option>
                                    <option value="IT">Italiana</option>
                                    <option value="ES">Espanhola</option>
                                </select>
                            </div>
                            <div class="error-message">Nacionalidade é obrigatória</div>
                        </div>
                        ${passengerNumber === 1 ? `
                        <div class="form-group">
                            <label>Email</label>
                            <div class="input-wrapper">
                                <i class="fas fa-envelope"></i>
                                <input type="email" class="form-input" name="email" placeholder="email@exemplo.com">
                            </div>
                        </div>
                        ` : '<div class="form-group"></div>'}
                    </div>
                    ` : ''}
                </form>
            `;
            
            return passengerCard;
        }

        function updatePricingSummary() {
            const flight = selectedFlightData;
            const baseFare = flight.price.base;
            const taxes = flight.price.taxes?.reduce((sum, tax) => sum + tax.amount, 0) || 0;
            const serviceFee = 45; // Taxa fixa de serviço
            const subtotal = baseFare + taxes + serviceFee;
            
            document.getElementById('base-fare').textContent = `R$ ${baseFare.toFixed(2)}`;
            document.getElementById('taxes-fees').textContent = `R$ ${taxes.toFixed(2)}`;
            document.getElementById('service-fee').textContent = `R$ ${serviceFee.toFixed(2)}`;
            document.getElementById('subtotal').textContent = `R$ ${subtotal.toFixed(2)}`;
            document.getElementById('total-amount').textContent = `R$ ${subtotal.toFixed(2)}`;
        }

        // ====================================
        // GERAÇÃO DE CÓDIGO DE RESERVA
        // ====================================

        function generateBookingCode() {
            const prefix = 'FMD';
            const year = new Date().getFullYear();
            const random = Math.floor(Math.random() * 100000).toString().padStart(5, '0');
            bookingCode = `${prefix}-${year}-${random}`;
            
            document.getElementById('booking-code').value = bookingCode;
        }

        // ====================================
        // CONFIGURAÇÃO DE EVENTOS
        // ====================================

        function setupEventListeners() {
            // Header scroll effect
            window.addEventListener('scroll', function() {
                const header = document.getElementById('header');
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });

            // Formatação de campos
            setupFieldFormatting();

            // Validação em tempo real
            setupRealTimeValidation();

            // Submissão do formulário
            document.getElementById('paymentForm').addEventListener('submit', handleFormSubmission);
        }

        function setupFieldFormatting() {
            // Formatação do número do cartão
            const cardNumberInput = document.querySelector('input[name="cardNumber"]');
            cardNumberInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
                let formattedValue = value.replace(/(\d{4})(?=\d)/g, '$1 ');
                
                if (formattedValue.length <= 19) {
                    e.target.value = formattedValue;
                }
                
                // Detectar bandeira do cartão
                detectCardBrand(value);
            });

            // Formatação da data de validade
            const expiryInput = document.querySelector('input[name="cardExpiry"]');
            expiryInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value;
            });

            // Formatação do CVV
            const cvvInput = document.querySelector('input[name="cardCVV"]');
            cvvInput.addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '');
            });

            // Formatação do telefone
            const phoneInput = document.querySelector('input[name="phone"]');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                }
                e.target.value = value;
            });
        }

        function setupRealTimeValidation() {
            const inputs = document.querySelectorAll('.form-input, .form-select');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    validateField(this);
                });

                input.addEventListener('input', function() {
                    if (this.classList.contains('error')) {
                        validateField(this);
                    }
                });
            });
        }

        function setupFormValidation() {
            // Validação será feita no momento da submissão
            console.log('Validação de formulário configurada');
        }

        // ====================================
        // VALIDAÇÃO DE CAMPOS
        // ====================================

        function validateField(field) {
            const value = field.value.trim();
            const fieldName = field.name;
            const fieldType = field.type;
            let isValid = true;
            let errorMessage = '';

            if (field.hasAttribute('required') && !value) {
                isValid = false;
                errorMessage = `${getFieldLabel(fieldName)} é obrigatório`;
            } else if (value) {
                switch (fieldType) {
                    case 'email':
                        isValid = validateEmail(value);
                        errorMessage = 'Email inválido';
                        break;
                    case 'tel':
                        isValid = validatePhone(value);
                        errorMessage = 'Telefone inválido';
                        break;
                    case 'date':
                        isValid = validateDate(value, fieldName);
                        errorMessage = getDateErrorMessage(fieldName);
                        break;
                    default:
                        if (fieldName === 'cardNumber') {
                            isValid = validateCardNumber(value);
                            errorMessage = 'Número do cartão inválido';
                        } else if (fieldName === 'cardExpiry') {
                            isValid = validateCardExpiry(value);
                            errorMessage = 'Data de validade inválida';
                        } else if (fieldName === 'cardCVV') {
                            isValid = validateCVV(value);
                            errorMessage = 'CVV inválido';
                        } else if (fieldName === 'passportNumber') {
                            isValid = validatePassport(value);
                            errorMessage = 'Número do passaporte inválido';
                        }
                }
            }

            updateFieldValidation(field, isValid, errorMessage);
            return isValid;
        }

        function updateFieldValidation(field, isValid, errorMessage) {
            const errorDiv = field.closest('.form-group').querySelector('.error-message');
            
            if (isValid) {
                field.classList.remove('error');
                if (errorDiv) {
                    errorDiv.style.display = 'none';
                }
            } else {
                field.classList.add('error');
                if (errorDiv) {
                    errorDiv.textContent = errorMessage;
                    errorDiv.style.display = 'block';
                }
            }
        }

        // ====================================
        // FUNÇÕES DE VALIDAÇÃO
        // ====================================

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validatePhone(phone) {
            const cleaned = phone.replace(/\D/g, '');
            return cleaned.length === 10 || cleaned.length === 11;
        }

        function validateDate(date, fieldName) {
            const dateObj = new Date(date);
            const today = new Date();
            
            if (fieldName === 'dateOfBirth') {
                return dateObj < today;
            } else if (fieldName === 'passportExpiry') {
                return dateObj > today;
            }
            
            return true;
        }

        function validateCardNumber(cardNumber) {
            const cleaned = cardNumber.replace(/\s/g, '');
            return cleaned.length >= 13 && cleaned.length <= 19 && /^\d+$/.test(cleaned);
        }

        function validateCardExpiry(expiry) {
            const match = expiry.match(/^(\d{2})\/(\d{2})$/);
            if (!match) return false;
            
            const month = parseInt(match[1], 10);
            const year = parseInt('20' + match[2], 10);
            const now = new Date();
            const expiryDate = new Date(year, month - 1);
            
            return month >= 1 && month <= 12 && expiryDate > now;
        }

        function validateCVV(cvv) {
            return cvv.length >= 3 && cvv.length <= 4 && /^\d+$/.test(cvv);
        }

        function validatePassport(passport) {
            return passport.length >= 6 && passport.length <= 12;
        }

        // ====================================
        // DETECÇÃO DE BANDEIRA DO CARTÃO
        // ====================================

        function detectCardBrand(cardNumber) {
            const brandSelect = document.querySelector('select[name="cardBrand"]');
            const firstDigit = cardNumber.charAt(0);
            const firstTwoDigits = cardNumber.substring(0, 2);
            const firstFourDigits = cardNumber.substring(0, 4);
            
            if (firstDigit === '4') {
                brandSelect.value = 'visa';
            } else if (firstTwoDigits >= '51' && firstTwoDigits <= '55') {
                brandSelect.value = 'mastercard';
            } else if (firstTwoDigits === '34' || firstTwoDigits === '37') {
                brandSelect.value = 'american-express';
            } else if (firstFourDigits === '6011' || firstTwoDigits === '65') {
                brandSelect.value = 'discover';
            } else if (firstFourDigits.startsWith('50') || firstFourDigits.startsWith('51') || 
                      firstFourDigits.startsWith('52') || firstFourDigits.startsWith('53') || 
                      firstFourDigits.startsWith('54') || firstFourDigits.startsWith('55')) {
                brandSelect.value = 'elo';
            }
        }

        // ====================================
        // SUBMISSÃO DO FORMULÁRIO
        // ====================================

        async function handleFormSubmission(event) {
            event.preventDefault();
            
            if (!validateAllForms()) {
                showNotification('Por favor, corrija os erros no formulário', 'error');
                return;
            }

            const bookingData = collectBookingData();
            
            if (!bookingData) {
                showNotification('Erro ao coletar dados do formulário', 'error');
                return;
            }

            await processBooking(bookingData);
        }

        function validateAllForms() {
            let isValid = true;
            
            // Validar todos os campos obrigatórios
            const requiredFields = document.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                if (!validateField(field)) {
                    isValid = false;
                }
            });

            // Validar checkboxes obrigatórios
            const requiredCheckboxes = document.querySelectorAll('input[type="checkbox"][required]');
            requiredCheckboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    isValid = false;
                    showNotification('Você deve aceitar os termos e condições', 'error');
                }
            });

            return isValid;
        }

        function collectBookingData() {
            try {
                const travelers = [];
                const passengerForms = document.querySelectorAll('.passenger-form');
                
                passengerForms.forEach((form, index) => {
                    const formData = new FormData(form);
                    const passengerType = form.getAttribute('data-type');
                    
                    const traveler = {
                        id: index + 1,
                        dateOfBirth: formData.get('dateOfBirth'),
                        name: {
                            firstName: formData.get('firstName'),
                            lastName: formData.get('lastName')
                        },
                        gender: formData.get('gender'),
                        travelerType: passengerType === 'Adulto' ? 'ADULT' : 
                                     passengerType === 'Criança' ? 'CHILD' : 'HELD_INFANT'
                    };

                    // Adicionar informações de documento se não for bebê
                    if (passengerType !== 'Bebê') {
                        traveler.documents = [{
                            documentType: 'PASSPORT',
                            number: formData.get('passportNumber'),
                            expiryDate: formData.get('passportExpiry'),
                            issuanceCountry: formData.get('nationality'),
                            validityCountry: formData.get('nationality'),
                            nationality: formData.get('nationality'),
                            holder: true
                        }];
                    }

                    // Adicionar informações de contato para o primeiro passageiro
                    if (index === 0) {
                        const contactForm = document.getElementById('contactForm');
                        const contactData = new FormData(contactForm);
                        
                        traveler.contact = {
                            emailAddress: contactData.get('email'),
                            phones: [{
                                deviceType: 'MOBILE',
                                countryCallingCode: '55',
                                number: contactData.get('phone')?.replace(/\D/g, '')
                            }]
                        };
                    }

                    travelers.push(traveler);
                });

                const contacts = [{
                    addresseeName: {
                        firstName: travelers[0]?.name.firstName,
                        lastName: travelers[0]?.name.lastName
                    },
                    companyName: 'FlightsMND',
                    purpose: 'STANDARD',
                    phones: travelers[0]?.contact?.phones,
                    emailAddress: travelers[0]?.contact?.emailAddress
                }];

                return {
                    flightOffer: selectedFlightData.rawOffer || selectedFlightData,
                    travelers: travelers,
                    contacts: contacts,
                    payment: collectPaymentData(),
                    bookingCode: bookingCode
                };

            } catch (error) {
                console.error('Erro ao coletar dados:', error);
                return null;
            }
        }

        function collectPaymentData() {
            const paymentForm = document.getElementById('paymentForm');
            const formData = new FormData(paymentForm);
            
            return {
                cardNumber: formData.get('cardNumber'),
                cardName: formData.get('cardName'),
                cardExpiry: formData.get('cardExpiry'),
                cardCVV: formData.get('cardCVV'),
                cardBrand: formData.get('cardBrand')
            };
        }

        // ====================================
        // PROCESSAMENTO DA RESERVA
        // ====================================

        async function processBooking(bookingData) {
            try {
                showLoading('Processando reserva...', 'Isso pode levar alguns minutos');
                
                // Primeiro, confirmar o preço do voo
                await confirmFlightPrice();
                
                // Depois, criar a reserva
                const response = await fetch(`${API_BASE}/flights/book`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();
                
                if (result.success) {
                    // Salvar dados da reserva
                    sessionStorage.setItem('bookingConfirmation', JSON.stringify(result.data));
                    sessionStorage.setItem('bookingReference', result.bookingReference);
                    
                    hideLoading();
                    showSuccessMessage();
                    
                    // Redirecionar após sucesso
                    setTimeout(() => {
                        window.location.href = 'booking-success.html';
                    }, 3000);
                    
                } else {
                    throw new Error(result.error || 'Erro ao processar reserva');
                }
                
            } catch (error) {
                console.error('Erro ao processar reserva:', error);
                hideLoading();
                showNotification('Erro ao processar reserva: ' + error.message, 'error');
            }
        }

        async function confirmFlightPrice() {
            try {
                const response = await fetch(`${API_BASE}/flights/price-confirm`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        flightOffer: selectedFlightData.rawOffer || selectedFlightData
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    confirmedPricing = result.data;
                    
                    // Verificar se o preço mudou
                    if (confirmedPricing.flightOffers && confirmedPricing.flightOffers[0]) {
                        const newPrice = confirmedPricing.flightOffers[0].price;
                        if (newPrice.total !== selectedFlightData.price.total) {
                            showNotification('Preço do voo foi atualizado!', 'warning');
                            selectedFlightData.price = newPrice;
                            updatePricingSummary();
                        }
                    }
                } else {
                    throw new Error(result.error || 'Erro ao confirmar preço');
                }
                
            } catch (error) {
                console.error('Erro ao confirmar preço:', error);
                showNotification('Não foi possível confirmar o preço. Prosseguindo com o preço original.', 'warning');
            }
        }

        // ====================================
        // FUNÇÕES DE INTERFACE
        // ====================================

        function showLoading(text = 'Processando...', description = 'Por favor, aguarde...') {
            const overlay = document.getElementById('loading-overlay');
            const loadingText = document.getElementById('loading-text');
            const loadingDescription = document.getElementById('loading-description');
            
            loadingText.textContent = text;
            loadingDescription.textContent = description;
            overlay.classList.add('active');
        }

        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            overlay.classList.remove('active');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${getNotificationIcon(type)}"></i>
                    <span>${message}</span>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Mostrar notificação
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Remover após 5 segundos
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 5000);
        }

        function showSuccessMessage() {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 10000;
                padding: 40px;
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                text-align: center;
                animation: popIn 0.5s ease-out;
                max-width: 500px;
                width: 90%;
            `;
            
            messageDiv.innerHTML = `
                <div style="color: #4CAF50; font-size: 60px; margin-bottom: 20px;">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 style="color: #333; margin-bottom: 15px; font-size: 24px;">Reserva Confirmada!</h3>
                <p style="color: #666; margin-bottom: 20px; font-size: 16px;">
                    Sua reserva foi processada com sucesso. Você receberá um email com os detalhes.
                </p>
                <p style="color: #667eea; font-weight: 600; font-size: 18px;">
                    Código: ${bookingCode}
                </p>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <p style="color: #999; font-size: 14px;">
                        Redirecionando em 3 segundos...
                    </p>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            // Adicionar overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 9999;
                animation: fadeIn 0.3s ease-out;
            `;
            document.body.appendChild(overlay);
        }

        function showTerms() {
            showNotification('Termos e condições carregados', 'info');
        }

        function showPaymentTerms() {
            showNotification('Condições de pagamento carregadas', 'info');
        }

        // ====================================
        // FUNÇÕES AUXILIARES
        // ====================================

        function formatDuration(duration) {
            const matches = duration.match(/PT(\d+H)?(\d+M)?/);
            const hours = matches[1] ? matches[1].replace('H', 'h ') : '';
            const minutes = matches[2] ? matches[2].replace('M', 'm') : '';
            return (hours + minutes).trim();
        }

        function getAirlineName(code) {
            const airlines = {
                'AD': 'Azul',
                'G3': 'GOL',
                'JJ': 'LATAM',
                'LA': 'LATAM',
                'TP': 'TAP',
                'AF': 'Air France',
                'LH': 'Lufthansa',
                'AA': 'American Airlines',
                'DL': 'Delta',
                'UA': 'United',
                'BA': 'British Airways',
                'KL': 'KLM',
                'EK': 'Emirates',
                'QR': 'Qatar Airways'
            };
            return airlines[code] || code;
        }

        function getFieldLabel(fieldName) {
            const labels = {
                'firstName': 'Nome',
                'lastName': 'Sobrenome',
                'dateOfBirth': 'Data de nascimento',
                'gender': 'Gênero',
                'nationality': 'Nacionalidade',
                'passportNumber': 'Número do passaporte',
                'passportExpiry': 'Validade do passaporte',
                'email': 'Email',
                'phone': 'Telefone',
                'cardNumber': 'Número do cartão',
                'cardName': 'Nome no cartão',
                'cardExpiry': 'Validade do cartão',
                'cardCVV': 'CVV',
                'cardBrand': 'Bandeira do cartão'
            };
            return labels[fieldName] || fieldName;
        }

        function getDateErrorMessage(fieldName) {
            if (fieldName === 'dateOfBirth') {
                return 'Data de nascimento deve ser anterior a hoje';
            } else if (fieldName === 'passportExpiry') {
                return 'Passaporte deve ter validade futura';
            }
            return 'Data inválida';
        }

        function getNotificationIcon(type) {
            const icons = {
                'success': 'check-circle',
                'error': 'exclamation-circle',
                'warning': 'exclamation-triangle',
                'info': 'info-circle'
            };
            return icons[type] || 'info-circle';
        }

        // ====================================
        // ESTILOS ADICIONAIS
        // ====================================

        const additionalStyles = document.createElement('style');
        additionalStyles.textContent = `
            @keyframes popIn {
                from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            }
            
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            .form-input:valid {
                border-color: #4CAF50;
            }
            
            .form-input:invalid {
                border-color: #e74c3c;
            }
            
            .passenger-form {
                animation: slideUp 0.4s ease-out;
            }
            
            .payment-table .highlight {
                background: rgba(102, 126, 234, 0.1);
            }
        `;
        document.head.appendChild(additionalStyles);
    </script>
</body>
</html>